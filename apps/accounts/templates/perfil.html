{% extends "base.html" %}

{% block 'body' %}
    {% include 'partials/navbar.html' %}
  <main>
    <header class="relative isolate pt-16">
      <div class="absolute inset-0 -z-10 overflow-hidden" aria-hidden="true">
        <div class="absolute left-16 top-full -mt-16 transform-gpu opacity-50 blur-3xl xl:left-1/2 xl:-ml-80">
          <div class="aspect-[1154/678] w-[72.125rem] bg-gradient-to-br from-[#FF80B5] to-[#9089FC]" style="clip-path: polygon(100% 38.5%, 82.6% 100%, 60.2% 37.7%, 52.4% 32.1%, 47.5% 41.8%, 45.2% 65.6%, 27.5% 23.4%, 0.1% 35.3%, 17.9% 0%, 27.7% 23.4%, 76.2% 2.5%, 74.2% 56%, 100% 38.5%)"></div>
        </div>
        <div class="absolute inset-x-0 bottom-0 h-px bg-gray-900/5"></div>
      </div>
  
      <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
        
      </div>
    </header>
  
    <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
      <div class="mx-auto grid max-w-2xl grid-cols-1 grid-rows-1 items-start gap-x-8 gap-y-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
        <div class="lg:col-start-3 lg:row-end-1">
          <div class="rounded-lg bg-gray-50 shadow-sm ring-1 ring-gray-900/5">
            <dl class="flex flex-wrap">
              <div class="flex-auto pl-6 pt-6">
                <dt class="text-sm/6 font-semibold text-gray-900">Saldo</dt>
                <dd class="mt-1 text-base font-semibold text-gray-900">R$ {{request.user.balance|floatformat:2}}</dd>
              </div>
              

              <div class="mt-6 flex w-full flex-none gap-x-4 border-t border-gray-900/5 px-6 pt-6">
                <dt class="flex-none">
                  <span class="sr-only">Client</span>
                  <svg class="h-6 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-5.5-2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0ZM10 12a5.99 5.99 0 0 0-4.793 2.39A6.483 6.483 0 0 0 10 16.5a6.483 6.483 0 0 0 4.793-2.11A5.99 5.99 0 0 0 10 12Z" clip-rule="evenodd" />
                  </svg>
                </dt>
                <dd class="text-sm/6 font-medium text-gray-900">{{request.user.first_name}}</dd>
              </div>

              <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                <dt class="flex-none">
                  <span class="sr-only">E-mail</span>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-5 text-gray-400">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 1 0-2.636 6.364M16.5 12V8.25" />
                  </svg>
                </dt>
                <dd class="text-sm/6 text-gray-500">
                  <p>{{request.user.email}}</p>
                </dd>
              </div>

              <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                <dt class="flex-none">
                  <span class="sr-only">Cpf/Cnpj</span>
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-5 text-gray-400">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                  </svg>
                  
                </dt>
                <dd class="text-sm/6 text-gray-500">{{request.user.cpf_cnpj}}</dd>
              </div>
            </dl>
            <div class="mt-6 border-t border-gray-900/5 px-6 py-6">
              <a href="#" class="text-sm/6 font-semibold text-gray-900">Histórico de saldo <span aria-hidden="true">&rarr;</span></a>
            </div>
          </div>
        </div>
  
        <!-- Invoice -->
        <div class="-mx-4 px-4 py-8 shadow-sm ring-1 ring-gray-900/5 sm:mx-0 sm:rounded-lg sm:px-8 sm:pb-14 lg:col-span-2 lg:row-span-2 lg:row-end-2 xl:px-16 xl:pb-20 xl:pt-16">
          {% if messages %}
            {% for message in messages %}
              <div class="ring-1 rounded-md text-sm p-2 {{ message.tags }}">
                {{message}}
              </div>
              <br>
            {% endfor %}
          
          {% endif %}
          <h2 class="text-xl font-semibold text-gray-900">Token API</h2>
          <p class="text-sm/6 text-gray-500">Copie o seu token de API e o mantenha em segurança</p>
          <div class="mt-6 grid grid-cols-1 gap-6 text-sm/6 sm:grid-cols-4">
            <div class="col-span-2"><input value="{{access_token.token}}" class="block w-full rounded-md border-0 px-2 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm/6" type="text" disabled></div>
            <div class="col-span-1"><a href="{% url 'generate_token' %}" class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Atualizar token</a></div>
          </div>
          
          <div class="mt-6 border-t border-gray-900/30 py-6">
            <h2 class="text-xl font-semibold text-gray-900">Webhook</h2>
            <p class="text-sm/6 text-gray-500">Adicione a URL que deseja que enviemos as requisições de Webhook</p>
            <div class="mt-6 grid grid-cols-1 gap-6 text-sm/6 sm:grid-cols-4">
                <div class="col-span-2"><form action="{% url 'set_webhook' %}" method="GET"><input name="webhook" value="{% if request.user.webhook %}{{request.user.webhook}}{% endif %}" class="block w-full rounded-md border-0 px-2 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm/6" type="text"></div>
                <div class="col-span-1"><button class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Salvar Webhook</button></form></div>
              </div>
          </div>
            <div class="mt-6 border-t border-gray-900/30 py-6">
                <h2 class="text-xl font-semibold text-gray-900">Logs de Webhooks</h2>
                <p class="text-sm/6 text-gray-500">Veja o histório de requisições que fizemos para o seu webhook.</p>

                <table class="mt-2 w-full whitespace-nowrap text-left text-sm/6">
                  
                    <thead class="border-b border-gray-200 text-gray-900">
                    <tr>
                        <th scope="col" class="px-0 py-3 font-semibold">Request</th>
                        
                        <th scope="col" class="py-3 pl-8 pr-0 text-right font-semibold">Status</th>
                    </tr>
                    </thead>
                    <tbody>
                      {% for log in logs %}
                        <tr class="border-b border-gray-100">
                            <td class="max-w-0 px-0 py-5 align-top">
                            <div class="truncate font-medium text-gray-900">{{log.url}}</div>
                            <div class="truncate text-gray-500">{{log.create_at}}</div>
                            </td>
                            <td class="py-5 pl-8 pr-0 text-right align-top tabular-nums text-gray-700"><a href="{% url 'view_log' log.id %}"><span class="inline-flex items-center rounded-md {% if log.status == 200 %}bg-green-50 ring-green-600/20 text-green-700{% else %}bg-red-50 ring-red-600/20 text-red-700 {% endif %} px-2 py-1 text-xs font-medium  ring-1 ring-inset">{{log.status}}</span></a></td>
                        </tr>
                      {% endfor %}
                   
                    </tbody>
                    
                </table>

            </div>
        </div>
  
        <div class="lg:col-start-3">
          <!-- Activity feed -->
          <h2 class="text-sm/6 font-semibold text-gray-900">Suas cobranças</h2>
          <ul role="list" class="mt-6 space-y-6">
            {% for invoice in invoices %}
              <li class="relative flex gap-x-4">
                <div class="absolute -bottom-6 left-0 top-0 flex w-6 justify-center">
                  <div class="w-px bg-gray-200"></div>
                </div>
                <div class="relative flex size-6 flex-none items-center justify-center bg-white">
                  <div class="size-1.5 rounded-full bg-gray-100 ring-1 ring-gray-300"></div>
                </div>
                <p class="flex-auto py-0.5 text-xs/5 text-gray-500"><span class="font-medium text-gray-900">{{invoice.id}} - {{invoice.dateCreated}}</span></p>
                <p class="flex-none py-0.5 text-xs/5 text-gray-500"><a href="{{invoice.invoiceUrl}}"><span class="inline-flex items-center rounded-md  {% if invoice.status == 'CONFIRMED' or invoice.status == 'RECEIVED' %}bg-green-50 ring-green-600/20 text-green-700 {% else %}bg-yellow-50 ring-yellow-600/20 text-yellow-700 {% endif %}px-2 py-1 text-xs font-medium  ring-1 ring-inset ">{{invoice.status}}</span></a></p>
              </li>
            {% endfor %}
          </ul>
  
         
          </div>
        </div>
      </div>
    </div>
  </main>
{% endblock 'body' %}